"use strict";var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),bench={oncycle:null,teardown:null,title:null,tests:{},suite:null};func("benchmarkCode",function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bench.tests[t]=[e,n]}),func("title",function(t){return bench.title=t}),func("teardown",function(t){return bench.teardown=t}),func("oncycle",function(t){return bench.oncycle=t}),window.beautify=require("js-beautify");var Benchmark=require("benchmark"),ProgressBar=require("progressbar.js"),isRunning=!1,isSaving=!1,isModifiable="true"===$$(".modal.runner").attr("data-exec-script"),isEditPage="true"===$$("div[data-edit-test]").html(),signedIn="true"===$$("div[data-signedIn]").html();$(function($){function closeDialog(t){return _$.alert({title:"Error",content:t,backgroundDismiss:!0}),setTimeout(function(t){_$(".modal#runner").modal("hide")},1)}function publishTest(t){return new Promise(function(e,n){_$.confirm({content:function(){return _$.ajax({url:"/addtest",method:"post",timeout:14e3,data:{originalSlug:t.slugInput,slug:t.slug,title:t.title,jscode1:t.jscode1,jscode2:t.jscode2,htmlcode:t.htmlcode,publish:t.publish}}).done(function(t){var i=void 0;(i=isErrorMessage(t))?n("Error: "+i):e(t)}).fail(function(t,e){n("Server Error, "+({error:"try again"}[e]||e))})},contentLoaded:function(t,e,n){isSaving=!1,this.close()}})})}var _$=$;$$("#run_test").click(function(ev){if(!bench.suite||!bench.suite.running){isRunning=!0,$$("button.test-btn#save_test").hide();var __setupCode=ace.edit("editor1").getValue(),__testCode=ace.edit("editor2").getValue(),__htmlCode=ace.edit("editor3").getValue();if(isModifiable){bench.tests={};try{if($$("div#data-html-code").html(__htmlCode),eval(__setupCode+__testCode),0==Object.keys(bench.tests).length)throw"No test case found"}catch(t){return isRunning=!1,_$.alert({title:"Error",content:t+"",backgroundDismiss:!0,theme:"material"}),void setTimeout(function(t){_$(".modal#runner").modal("hide")},1)}}if(0==Object.keys(bench.tests).length)return isRunning=!1,closeDialog("No test case found");$$("div#canvas").html("<canvas id='test-result'></canvas>"),$$(".modal #circle-modal, .modal #current-test").html(""),Benchmark.prototype.setup=__setupCode,Benchmark.prototype.teardown=bench.teardown;var suite=new Benchmark.Suite;bench.suite=suite;var testsCount=0,results=[],currentTest=0;for(var t in bench.tests)if(bench.tests.hasOwnProperty(t)){var _bench$tests$t=_slicedToArray(bench.tests[t],2),fn=_bench$tests$t[0],async=_bench$tests$t[1];suite.add(t,fn,{defer:async}),testsCount+=1}var bar=new ProgressBar.Circle("#circle-modal",{color:"#aaa",strokeWidth:4,trailWidth:1,text:{autoStyleContainer:!0},from:{color:"#aaa",width:1},to:{color:"#24272a",width:2},step:function(t,e){e.path.setAttribute("stroke",t.color),e.path.setAttribute("stroke-width",t.width),e.setText(~~(100*e.value())+"%")}});suite.on("start",function(t){$$(".modal #current-test").html("Running Benchmark: "+t.currentTarget[0].name)}),suite.on("cycle",function(t){currentTest+=1,results.push(t.target+""),"function"==typeof bench.oncycle&&bench.oncycle.call(this,t),currentTest<testsCount&&$$(".modal #current-test").html("Running Benchmark: "+t.currentTarget[currentTest].name),bar.set(currentTest/testsCount)}),suite.on("complete",function(t){isRunning=!1,$$(".modal #current-test").html("<div center>Operations per second (higher is better)</div>"),bar.destroy(),$$("button.test-btn#close_runner").show(),$$("button.test-btn#save_test").show();var e=_$("canvas#test-result")[0].getContext("2d"),n=[],i=[],r=-1/0;this.filter(function(t){r=Math.max(r,~~t.hz),n.push(~~t.hz),i.push(t.name)});new Chart(e,{type:"horizontalBar",data:{labels:i,datasets:[{label:(bench.title||"Benchmark")+" - jsmarka.com",backgroundColor:COLORS,borderColor:"#eee",data:n}]},options:{tooltips:{callbacks:{footer:function(t,e){return results[t[0].index]},afterFooter:function(t,e){return t[0].xLabel===r?" - fastest":" "+Math.round(100-t[0].xLabel/r*100)+"% slower"}}}}})}),suite.run({async:!0})}}),$$("button#close_runner").click(function(t){bench.suite&&bench.suite.abort()}),$$("textarea, html").bind("keydown","Ctrl+return",function(){isRunning||isSaving||$$("#run_test").click()}),$$("textarea, html").bind("keydown","Ctrl+.",function(){if(!isRunning&&!isSaving&&isModifiable){$$("div#data-html-code").html(ace.edit("editor3").getValue());try{eval(ace.edit("editor1").getValue()+ace.edit("editor2").getValue())}catch(t){_$.alert({title:"Error",content:t+"",backgroundDismiss:!0,theme:"material"})}}}),$$("textarea, html").bind("keydown","Ctrl+s",function(e){if(e.preventDefault(),!isRunning&&!isSaving&&isModifiable){$$("div#data-html-code").html(ace.edit("editor3").getValue());try{eval(ace.edit("editor1").getValue()+ace.edit("editor2").getValue())}catch(e){return _$.alert({title:"Error",content:e+"",backgroundDismiss:!0,theme:"material"})}isEditPage?$$("button.edit#save_test").trigger("click"):$$("button.test-btn#save_test").trigger("click")}}),_$(ace.edit("editor3").textInput.getElement()).on("keypress",function(){$$("div#data-html-code").html(ace.edit("editor3").getValue())}),$$("button.test-btn#save_test").click(function(){if(!isSaving&&!isEditPage){if(isSaving=!0,!bench.title)return _$.alert("No title set, use the 'title()' function to set the title of your test");var t=entify(ace.edit("editor1").getValue()),e=entify(ace.edit("editor2").getValue()),n=entify(ace.edit("editor3").getValue());signedIn?_$.confirm({title:"Save test",content:"\n\t\t\t\t\t<form>\n\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t<label>title</label>\n\t\t\t\t\t\t\t<input name='title' type='text' value=\""+bench.title+"\" class=\"title form-control\" required/>\n\t\t\t\t\t\t\t<br>\n\t\t\t\t\t\t\t<label>slug</label>\n\t\t\t\t\t\t\t<input name='slug' type='text' value=\""+toSlug(bench.title)+'" class="slug form-control" required />\n\n\t\t\t\t\t\t\t<div class="checkbox">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t  <input class="publish" name="publish" type="checkbox"> Publish test\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t',buttons:{formSubmit:{text:"Submit",btnClass:"btn-dark",action:function(){var i=this.$content,r=i.find("input.slug").val(),o=toSlug(r),a=i.find("input.title").val(),s=i.find("input.publish").is(":checked");if(!o.length||!a.length)return isSaving=!1,_$.alert({title:"Error",content:"Fill in required fields",backgroundDismiss:!0,theme:"material"});publishTest({slug:o,title:a,jscode1:t,jscode2:e,htmlcode:n,publish:s,slugInput:r}).then(function(t){_$.alert("Test published, redirecting ..."),window.location="/"+t}).catch(function(t){_$.alert(t)})}},cancel:function(){isSaving=!1}},onContentReady:function(){var t=this,e=t.$content,n=e.find("input.slug");e.find("input.title").on("keyup",function(){n.val(toSlug(this.value))}),e.find("form").on("submit",function(e){e.preventDefault(),t.$$formSubmit.trigger("click")})}}):_$.alert({title:"Sign in",escapeKey:!1,content:"You must sign in first",buttons:{ok:function(){isSaving=!1}}})}})});